<!DOCTYPE html>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
  <title>Arroyo Case Study</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="icon" href="./images/logos/color/arroyographic_color.svg" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <noscript>
    <link rel="stylesheet" href="assets/css/noscript.css" />
  </noscript>
</head>

<body class="is-preload">
  <!-- Header -->
  <header id="header">
    <nav>
      <ul>
        <li><a href="index.html" class="fa fa-home fa-3x" id="home-icon" ></a></li>
        <li>
          <a id="github-icon" href="https://github.com/Team-Arroyo/arroyo" class="icon brands fa-github fa-3x"
            target="_blank"></a>
        </li>
      </ul>
    </nav>
  </header>

  <!-- Wrapper -->
  <div id="wrapper">
    <!-- Main -->
    <section id="case-study" class="wrapper style1">
      <div class="inner">
        <h1 class="major">Case Study</h1>
        <span class="image fit"><img id="case-logo" src="images/logos/color/arroyographic_color.svg" alt="" /></span>
        <p class="c53 c58 title" id="h.jp0xgnj2fn3h"><span class="c0 c39">Arroyo Case Study</span></p>
        <h1 class="c6" id="section-1"><span class="c48 c65">1. </span><span class="c48">Introduction</span></h1>
        <p class="c12"><span>As systems become increasingly complex</span><sup><a href="#cmnt1"
              id="cmnt_ref1">[a]</a></sup><sup><a href="#cmnt2" id="cmnt_ref2">[b]</a></sup><span class="c2 c0">, it
            becomes
            more important - and simultaneously more difficult - to understand what is going on within them. The ability
            to
            monitor such systems and efficiently access specific information about them is vital.</span></p>
        <p class="c12"><span class="c2 c0">&lt;Continue intro-ing here?&gt;</span></p>
        <h2 class="c1 c29" id="h.776zvxylucft"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.39yhquwvqukz"><span class="c3 c0">Arroyo</span></h2>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 568.57px; height: 392.83px;"><img
              alt="" src="images/image23.jpg"
              style="width: 568.57px; height: 392.83px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c12"><span class="c2 c0">An arroyo is a creek bed or gulch that temporarily or seasonally fills with
            water
            after sufficient rain. </span></p>
        <p class="c12"><span>Somewhat similarly, Arroyo is a lightweight framework that performs rehydration, granularly
            rehydrating logs kept in cloud storage.</span></p>
        <h2 class="c1 c29" id="h.90gepc7k94hw"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.u1y6ehmfzmkw"><span class="c3 c0">Memely</span></h2>
        <p class="c12"><span class="c2 c0">To help illustrate what Arroyo is and why it is useful, let&rsquo;s meet
            Memely.
          </span></p>
        <p class="c12"><span class="c2 c0">Memely is a small image and video hosting service that strives to provide a
            &ldquo;one-stop shop for non-stop laughs&rdquo; by consolidating &nbsp;the most popular content being shared
            across the web into one place. </span></p>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 403.50px; height: 380.35px;"><img
              alt="" src="images/image15.png"
              style="width: 403.50px; height: 380.35px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c12"><span class="c16">Memely.com</span><span class="c2 c0">&nbsp;was not an overnight sensation, but
            over
            time their user base has grown considerably, exceeding even their most ambitious predictions. This growth
            enabled
            the Memely team to start generating pay-per-click ad revenue by hosting ads on their front page. With time,
            these
            profits became consistent and substantial enough that Memely was able to reinvest in their site by hiring a
            small
            team of full-time developers.</span></p>
        <p class="c12"><span class="c2 c0">The engineering team&rsquo;s first priority was to scale the Memely
            architecture to
            accommodate their growing user base. During the initial phase of infrastructural scaling, the complexity of
            Memely&rsquo;s system increased considerably, and it quickly became clear that the current system did not
            contain
            the level of observability required to continue scaling confidently. </span></p>
        <p class="c12"><span class="c2 c0">To complicate matters further, some troubling user behavior has necessitated
            an
            audit. The ad agency which Memely&rsquo;s site hosts ads from is concerned about possible &ldquo;click
            fraud&rdquo;. Over the past month the number of clicks, or &ldquo;user engagements&rdquo;, &nbsp;with the
            ads the
            agency generates and that memely.com hosts were far higher than usual. The agency has asked that the Memely
            team
            investigate: no small feat in Memely&rsquo;s increasingly complex infrastructure.</span></p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-2"><span>2. Observability</span></h1>
        <p class="c31 c53"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 313.00px; height: 313.00px;"><img
              alt="" src="images/image17.png"
              style="width: 313.00px; height: 313.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c31 c53"><span class="c55 c16 c0">&ldquo;To observe is to watch carefully.&rdquo; </span></p>
        <p class="c23"><span class="c0">Observability is the ability to measure the current state of a system using the
            data
            the system outputs. Instrumentation is adding code to output the data. </span><span class="c0">Data emitted
            by the
            system is called telemetry.</span><sup><a href="#cmnt3" id="cmnt_ref3">[c]</a></sup></p>
        <h2 class="c1 c29" id="h.6vdqssxgcpjy"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.681275l05qb4"><span class="c3 c0">The Three Pillars</span></h2>
        <p class="c23"><span class="c2 c0">The data types used in observability are metrics, traces, and logs.</span>
        </p>
        <h3 class="c1" id="h.uqz27g9oi4js"><span class="c14">Metrics</span></h3>
        <p class="c12"><span class="c2 c0">Metrics provide information about the state of a service at runtime.
            Typically,
            metrics are aggregations of data over a period of time. </span></p>
        <p class="c12"><span class="c2 c0">The most commonly used metrics are availability, request rate, utilization,
            and
            latency. They are often referred to as the four golden signals. The first signal, availability, is the
            percentage
            of requests that have errors, and the request rate is the number of requests per second. Utilization can be
            measured by the CPU usage of a system or by the available memory of a system. Finally, the overall response
            time
            of a system is latency. </span></p>
        <h3 class="c1" id="h.5d5hxkq2avu9"><span class="c14">Traces</span></h3>
        <p class="c23"><span class="c2 c0">Traces record the paths taken by a request through a distributed system.
            Traces are
            built from multiple spans. A span is a timestamped logical unit of work like an API call or a database write
            operation. Typically traces are represented by showing a collection of spans organized by time in a
            waterfall
            diagram or a flame graph. </span></p>
        <p class="c31 c53"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 516.00px; height: 367.68px;"><img
              alt="" src="images/image18.png"
              style="width: 516.00px; height: 367.68px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <h3 class="c1" id="h.z20auma9dxu6"><span class="c14">Logs</span></h3>
        <p class="c23"><span class="c0">Logs are text records of events, ideally with a timestamp. They can be in
            various
            formats, such as CSV, JSON, key-value pair, Common Event Format (CEF), plain text, </span><span
            class="c54"><a class="c33"
              href="https://www.google.com/url?q=http://www.ietf.org/rfc/rfc5424.txt&amp;sa=D&amp;source=editors&amp;ust=1660232264656747&amp;usg=AOvVaw1LzyhO2mzM6SzB4uLxh7IU">RFC
              5424</a></span><span class="c0">, and</span><span class="c54"><a class="c33"
              href="https://www.google.com/url?q=http://www.ietf.org/rfc/rfc3164.txt&amp;sa=D&amp;source=editors&amp;ust=1660232264656978&amp;usg=AOvVaw2XLTRsbSRPOwEoX5sjNQ6Q">&nbsp;RFC
              3164</a></span><span class="c2 c0">. Conversely, logs can also be completely unstructured. </span></p>
        <p class="c23"><span class="c2 c0">Developers can use a library like Winston or custom-written code for log
            instrumentation.</span></p>
        <p class="c23"><span class="c2 c0">Usually, because logs are the most detailed view of what is going on within a
            given
            application, logs are helpful for both troubleshooting and audits. </span></p>
        <h3 class="c1" id="h.10zpsl3qzsuo"><span class="c14">Scaling Logs</span></h3>
        <p class="c23"><span class="c2 c0">However, logs don&rsquo;t scale well. As the log volume increases, it can be
            challenging to find the needed information. Finding information in a distributed system can be
            time-consuming as
            you may have to comb through many log files from various applications and nodes individually. </span></p>
        <p class="c23"><span class="c2 c0">To find the information you need with a large log volume, you would need a
            way to
            gather the logs into a centralized location, search the centralized logs, and analyze the results of the
            search.
            One popular log management system uses Elasticsearch, Logstash, and Kibana together. This combination is
            called
            the ELK stack.</span></p>
        <h2 class="c1 c29" id="h.ig60pa39uxp0"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.um9tjiu5r29"><span class="c3 c0">ELK Stack</span></h2>
        <h3 class="c1" id="h.iuevmq4jf3nd"><span>Logstash</span></h3>
        <p class="c12"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 94.76px; height: 94.76px;"><img
              alt="" src="images/image20.png"
              style="width: 94.76px; height: 94.76px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c23"><span class="c2 c0">Logstash is a data collection engine with real-time pipelining capabilities.
            Logstash has three stages to it. First, events are generated at the input stage. For log management, this
            means
            the text files where logs are stored. Next are filters, where the inputs are modified or transformed. In
            this
            case, we will convert the text files into JSON. Finally, there are outputs. Modified inputs are shipped to
            the
            specified output. We will send the JSON files to Elasticsearch. </span></p>
        <h3 class="c1" id="h.bwp7ao6us04y"><span class="c14">Elasticsearch</span></h3>
        <p class="c12"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 96.78px; height: 96.78px;"><img
              alt="" src="images/image6.png"
              style="width: 96.78px; height: 96.78px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c23"><span class="c2 c0">Elasticsearch is a distributed document store, a real-time search engine, and
            an
            analytics engine. </span></p>
        <p class="c23"><span class="c2 c0">Each Elasticsearch cluster has many nodes for increased reliability, so
            Elasticsearch is distributed. Elasticsearch will store serialized JSON files as complex data.</span></p>
        <p class="c23"><span>Additionally,</span><span class="c0">&nbsp;as</span><span class="c2 c0">&nbsp;a search
            engine,
            Elasticsearch will index incoming documents in under a second using reverse indexing. Reverse indexing
            allows for
            a fast search. Also, Elasticsearch allows for SQL-like queries and full-text searches, plus complex queries
            that
            combine both search SQL-like queries and full-text searches.</span></p>
        <p class="c23"><span class="c2 c0">Finally, as an analytics engine, Elasticsearch allows for complex data
            summaries to
            find critical metrics, patterns, and trends.</span></p>
        <h3 class="c1" id="h.g66l39vusu8"><span class="c14">Kibana</span></h3>
        <p class="c12"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 97.78px; height: 97.78px;"><img
              alt="" src="images/image22.png"
              style="width: 97.78px; height: 97.78px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c23"><span class="c0">Kibana is a collection of graphical user interface applications that wrap around
            Elasticsearch. Inside Kibana, </span><span class="c0">the Discovery application</span><span
            class="c0">&nbsp;can
            be used to perform queries using Kibana Query Language.</span><span class="c0">&nbsp;Users can create charts
            and
            graphs using Kibana Lens</span><span class="c2 c0">, while Kibana Dashboard is used to create dashboards.
            Finally,
            you can use Kibana to manage the ELK stack.</span></p>
        <p class="c23"><span class="c0">Let&rsquo;s return to Memely to see how they use their ELK Stack.</span></p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-3"><span class="c15 c0">3. Log Rehydration</span></h1>
        <h2 class="c1" id="h.1ksznyb7khwk"><span class="c3 c0">Memely&rsquo;s ELK Stack</span></h2>
        <p class="c12"><span class="c2 c0">After implementing an ELK stack of their own, the Memely team feels more
            confident
            about continuing with their scaling efforts. Additionally, implementing a centralized logging pipeline has
            proven
            to be an invaluable tool within the team&#39;s observability arsenal.</span></p>
        <p class="c12"><span class="c2 c0">However, implementing an ELK stack has introduced a separate set of
            challenges for
            the Memely team. Elasticsearch&#39;s strength is fast searching, but the search speed slows as the number of
            documents increases. Additionally, increasing the number of documents introduces significant complexity to
            maintaining Memely&#39;s Elasticsearch cluster.</span></p>
        <p class="c12"><span class="c2 c0">To address these challenges, the Memely team decides to store their logs in
            two
            locations. First, Memely will ship their logs to AWS S3 for archival storage. Secondly, Memely will index
            only the
            most recent 14 days&#39; worth of logs into Elasticsearch. In addition to saving money, this solution
            reduces the
            number of documents stored in Elasticsearch and grants the Memely team peace of mind knowing all their logs
            are
            archived in secure cloud storage.</span></p>
        <h2 class="c53 c29 c57" id="h.5deia7c3q4i9"><span class="c22 c0"></span></h2>
        <h2 class="c57 c53" id="h.mcz6mixxpprr"><span class="c3 c0">The Audit</span></h2>
        <h3 class="c1" id="h.otb04fuu4qvn"><span class="c14">Suspicious Client IP</span></h3>
        <p class="c12"><span>When the ad agency expressed concerns about possible click fraud, the Memely team was
            quickly
            able to gather information about the requests made to </span><span class="c16">memely.com</span><span
            class="c2 c0">&nbsp;over the previous two weeks. Memely&rsquo;s ELK Stack played an invaluable role here,
            and the
            team was quickly able to establish that one client IP address was responsible for a drastically
            disproportionate
            number of the requests made in the previous 14 days.</span></p>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 555.24px; height: 366.77px;"><img
              alt="" src="images/image14.png"
              style="width: 566.79px; height: 371.25px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <h3 class="c1" id="h.toq8w34y5ywx"><span class="c14">Suspicious Behavior</span></h3>
        <p class="c12"><span>In order to better understand how this client had been interacting with their site, the
            Memely
            team looked at all of the indexed web server logs involving the client&rsquo;s IP address. They discovered
            that
            all of the requests issued by the client had been GET requests sent to the root page of memely.com, where
            the
            majority of the hosted ads are served. They also observed that the client made no attempts to visit any
            other
            pages within the site, which deviates from the way that most users interact with their site. At this point
            the
            Memely team is confident that they are dealing with a malicious user, reinforcing suspicions that
          </span><span class="c16">memely.com </span><span class="c2 c0">experienced click fraud within the past 30
            days.</span></p>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 590.59px; height: 376.31px;"><img
              alt="" src="images/image16.png"
              style="width: 590.59px; height: 386.54px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c12"><span>The next thing the Memely</span><span class="c2 c0">&nbsp; team would like to know is how
            long
            this has been going on. Because they only have the most recent 14 days of logs indexed in Elasticsearch, the
            Memely team does not currently have all of the data that they need in order to complete their audit.</span>
        </p>
        <h2 class="c1 c29" id="h.3twhmp1xtu9h"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.kn7c135526iq"><span class="c3 c0">Log Rehydration</span></h2>
        <p class="c12"><span class="c2 c0">What the Memely team needs is a way to transfer logs they currently have
            archived
            in AWS S3 back into Elasticsearch so that they can search them within an environment that is feature-rich
            and
            familiar. This process of transferring archived logs back into Elasticsearch for easier searching is often
            referred to as log &ldquo;rehydration&rdquo; and the Memely team has a few options at their disposal.</span>
        </p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-4"><span class="c15 c0">4. Existing Solutions</span></h1>
        <h2 class="c1" id="h.gpbvwoneax3i"><span class="c3 c0">Commercial Solutions</span></h2>
        <p class="c12"><span class="c2 c0">There is no shortage of commercially available observability solutions
            offering log
            rehydration. They all boast a multitude of features, and are all all-in-one solutions, meaning that users do
            not
            need to concern themselves with scaling complexities or infrastructure management. &nbsp;</span></p>
        <p class="c12"><span class="c24 c16 c0">&lt;insert pic of commercial options here&gt;</span></p>
        <p class="c12"><span>While a commercial solution is an option the Memely team could explore, they have
            reservations
            about the costs associated, the possible added complexity, and the time it may take to get up to speed with
            an
            unfamiliar new tool while trying to complete their audit. The Memely team would like to avoid paying for
            features
            they don&rsquo;t need, and they really want to avoid the hassle of having to relocate their log data.
          </span></p>
        <h2 class="c1 c29" id="h.uwytpcmwf5or"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.pb18rrp1v04r"><span class="c3 c0">DIY Solutions</span></h2>
        <p class="c12"><span class="c2 c0">If a commercial solution doesn&rsquo;t quite fit Memely&rsquo;s needs, there
            are
            many open-source tools and plugins available to help Memely achieve their objectives. The main benefit of a
            DIY
            solution is that the Memely team could continue to use their existing ELK Stack and log archival solution.
            Additionally, a DIY solution would help minimize costs.</span></p>
        <p class="c12"><span class="c2 c0">Because the Memely team is still relatively small, they may not have the time
            and
            resources to devote to researching all of the available tools they could employ to build a rehydration tool
            in-house.</span></p>
        <p class="c12"><span>The scarcity of turn-key, free rehydration tools is one of the primary reasons we decided
            to
            build Arroyo. </span><span>While both the commercial and DIY approaches are valid solutions, </span><sup><a
              href="#cmnt4" id="cmnt_ref4">[d]</a></sup></p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-5"><span class="c15 c0">5. Arroyo</span></h1>
        <p class="c12"><span>Arroyo is a lightweight framework that facilitates the granular rehydration of logs. In
            addition,
          </span><span>arroyo</span><sup><a href="#cmnt5" id="cmnt_ref5">[e]</a></sup><span>&nbsp;allows users to
            specify a
            specific timeframe to search for relevant log files. Arroyo also supports providing log attributes so users
            can
            conditionally rehydrate logs for more granular control over their ability to search. Search results are
            retrieved
            from a user&#39;s S3 bucket and reingested into Elasticsearch.</span></p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-6"><span>6. Using Arroyo</span></h1>
        <h2 class="c1" id="h.a8e85spaif40"><span class="c3 c0">Installation</span></h2>
        <p class="c12"><span>Users will need to clone the deployment repo, install dependencies, and create a .env file.
          </span></p>
        <h2 class="c1" id="h.aaq0qp6p1voq"><span class="c3 c0">Deployment</span></h2>
        <p class="c12"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 843.02px; height: 384.79px;"><img
              alt="" src="images/image10.gif"
              style="width: 843.02px; height: 384.79px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <h4 class="c46" id="h.9ues041354pd"><span class="c35">To deploy AWS infrastructure</span></h4>
        <p class="c12"><span class="c2 c0">npm run deploy</span></p>
        <h2 class="c1" id="h.tdd73estpchp"><span class="c3 c0">Launching Arroyo</span></h2>
        <p class="c12"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 843.02px; height: 384.79px;"><img
              alt="" src="images/image13.gif"
              style="width: 843.02px; height: 384.79px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <h4 class="c46" id="h.em32b26dj7vl"><span class="c35">To start Arroyo for the first time</span></h4>
        <p class="c12"><span class="c2 c0">docker compose-up</span></p>
        <h4 class="c46" id="h.jruljltqgtme"><span class="c35">To restart Arroyo from a previously used Docker
            container</span>
        </h4>
        <p class="c12"><span class="c2 c0">docker compose start</span></p>
        <h2 class="c1" id="h.wyyt7443fvva"><span class="c3 c0">Shutting Down</span></h2>
        <h4 class="c46" id="h.4g1pagqimgy7"><span class="c35">To stop Arroyo</span></h4>
        <p class="c12"><span class="c2 c0">docker compose stop</span></p>
        <h4 class="c46" id="h.npovixahctki"><span class="c35">To stop Arroyo and remove containers and docker
            network</span>
        </h4>
        <p class="c12"><span class="c2 c0">docker compose down</span></p>
        <h2 class="c1" id="h.xxmp5pgqf4n"><span class="c3 c0">Teardown</span></h2>
        <p class="c12"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 843.02px; height: 384.79px;"><img
              alt="" src="images/image19.gif"
              style="width: 843.02px; height: 384.79px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <h4 class="c46" id="h.2ug1j5o9r4ra"><span class="c35">To destroy AWS infrastructure:</span></h4>
        <p class="c12"><span>npm run destroy</span></p>
        <h2 class="c18" id="h.3txk55qk73jh"><span class="c40 c0">Rehydration</span></h2>
        <p class="c18"><span class="c2 c0">There are two ways to rehydrate logs using Arroyo. The first method, bulk
            rehydration, allows users to re-ingest whole log files. The second method, query rehydration, will enable
            users to
            re-ingest only relevant log entries instead of entire log files. Query rehydration saves space in
            Elasticsearch.
          </span></p>
        <p class="c18 c21"><span class="c2 c0"></span></p>
        <h2 class="c18" id="h.gjfi4z2tt0ko"><span class="c0 c40">Bulk Rehydration</span></h2>
        <p class="c18"><span class="c2 c0">To start bulk re-ingestion, click on the `By Date Range` tab and enter a
            start date
            and an end date. Then, click on the `Select Log Files` button. A list of matching files will populate in the
            `Select` section. Choose the files to be re-ingested and click `Select Ingested Files`. Once notification of
            job
            completion is received, the ingested logs will be available in Kibana.</span></p>
        <p class="c8"><span class="c2 c0"></span></p>
        <p class="c12"><img></p>
        <h2 class="c1 c29" id="h.7bn6iuqw5qui"><span class="c22 c0"></span></h2>
        <h2 class="c18" id="h.f3xf3rxgjdji"><span class="c40 c0">Query Rehydration</span></h2>
        <p class="c18"><span class="c2 c0">To start query re-ingestion, click on the `By Search Term` tab and enter
            start and
            end dates. Next, enter a log attribute (request_method) and the log attribute value ( GET) and click the +
            button.
            Users can enter up to two pairs of log attributes and log attribute values. Finally, click on `Ingest
            Matching Log
            Entries to start re-ingestion. Once notification of re-ingestion is received, the ingested log entries will
            be
            available in Kibana.</span></p>
        <p class="c8"><span class="c2 c0"></span></p>
        <p class="c12"><img></p>
        <h2 class="c1" id="h.5jo4vhuh41tg"><span class="c3 c0">Index Cleanup</span></h2>
        <p class="c12"><span class="c2 c0">One of the challenges with using Elasticsearch is striking a balance between
            having
            too much information on hand and too little information. Arroyo reintroduces data into Elasticsearch,
            leading to
            questions surrounding data management. For example, how can users remove rehydrated data once they have
            derived
            its value?</span></p>
        <p class="c12"><span class="c2 c0">Arroyo&#39;s proposed solution to these questions is to provide users with a
            Logstash configuration template that they can utilize to set up their http input plugin. In addition, the
            provided
            template instructs Elasticsearch to create a new, separate index for rehydrated logs generated by
            Arroyo.</span>
        </p>
        <p class="c12"><span class="c2 c0">Creating a new index allows users to delete the entire index and any
            rehydrated
            logs without deleting day-to-day logs. Our team designed Arroyo to integrate into a user&#39;s existing ELK
            stack,
            and our application mustn&#39;t interfere with a user&#39;s existing workflow.</span></p>
        <p class="c12"><span class="c2 c0">The http input template Arroyo provides is a guideline, but users are
            encouraged to
            configure Logstash&#39;s http input to suit their use case.</span></p>
        <p class="c12"><span class="c2 c0">For ease of data management, we encourage users to follow Arroyo&#39;s
            pattern of
            creating a new index for rehydration purposes.</span></p>
        <p class="c12"><img></p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-7"><span class="c15 c0">7. Arroyo Architecture</span></h1>
        <h3 class="c1" id="h.jr9rjji2nfut"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 776.70px; height: 491.52px;"><img
              alt="" src="images/image7.png"
              style="width: 776.70px; height: 491.52px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></h3>
        <p class="c4"><span class="c10 c0">Arroyo application consists of Arroyo Client and Arroyo Server. Arroyo Client
            is a
            React application that provides the Arroyo UI. Arroyo Server is a Node application that interacts with AWS
            resources and facilitates rehydration and reingestion of logs.</span></p>
        <p class="c4"><span class="c25">Both, Arroyo Client and Arroyo Server, are run in a Docker container. Arroyo
            Client
            and Arroyo Server are built from two separate </span><span class="c25">docke</span><sup><a href="#cmnt6"
              id="cmnt_ref6">[f]</a></sup><span class="c10 c0">r images and are run using docker compose.</span></p>
        <p class="c4"><span class="c10 c0">Let&rsquo;s go over AWS services that Arroyo uses to perform the rehydration
            of
            logs.</span></p>
        <p class="c23 c21"><span class="c32 c0"></span></p>
        <h2 class="c1" id="h.fys8my9fcq3x"><span class="c3 c0">Arroyo AWS Resources</span></h2>
        <p class="c4"><span class="c25">During the installation, Arroyo </span><span class="c25">provisions</span><span
            class="c10 c0">&nbsp;a number of &nbsp;AWS resources. This is done programmatically using AWS SDK. </span>
        </p>
        <p class="c4"><span class="c25">Arroyo provisions Rehydration SQS Queue and Status SQS Queue as well as their
            corresponding </span><span class="c25">Dead Letter Queues. Having DLQ</span><sup><a href="#cmnt7"
              id="cmnt_ref7">[g]</a></sup><span class="c10 c0">&nbsp;associated with each of the main queues ensures
            easier
            troubleshooting and also makes sure that the queues are not blocked in case of a message failure. </span>
        </p>
        <p class="c4"><span class="c10 c0">Arroyo creates a separate S3 bucket to host the Lambda deployment
            package.</span>
        </p>
        <p class="c4"><span class="c10 c0">In addition to that, Arroyo also creates an IAM role for Lambda Function. To
            make
            sure that Lambda is able to interact with other AWS services, we attach several permissions to the role.
          </span>
        </p>
        <p class="c4"><span class="c10 c0">Lastly, Arroyo creates the Lambda Function itself and sets the Rehydration
            SQS
            Queue as its Event trigger. </span></p>
        <p class="c12"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 745.41px; height: 430.21px;"><img
              alt="" src="images/image3.png"
              style="width: 745.41px; height: 430.21px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c4 c21"><span class="c10 c0"></span></p>
        <p class="c4"><span class="c10 c0">Conceptually we can split Arroyo application into three key phases:
            Rehydrate,
            Reingest, and Notify. Let&rsquo;s take a look at each of them.</span></p>
        <p class="c4 c21"><span class="c0 c49"></span></p>
        <h2 class="c1" id="h.73bkhqh5867t"><span class="c3 c0">Rehydrate</span></h2>
        <p class="c12"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 718.44px; height: 328.67px;"><img
              alt="" src="images/image21.png"
              style="width: 763.05px; height: 429.38px; margin-left: -9.01px; margin-top: -8.33px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c4"><span class="c25">During the Rehydrate phase Arroyo receives the request containing </span><span
            class="c25">the file names</span><sup><a href="#cmnt8" id="cmnt_ref8">[h]</a></sup><span
            class="c10 c0">&nbsp;that
            need to be rehydrated either fully or via a query, performs the rehydration itself, and then forwards the
            result
            to the next phase. </span></p>
        <p class="c4"><span class="c25">During the Rehydrate phase</span><sup><a href="#cmnt9"
              id="cmnt_ref9">[i]</a></sup><span class="c10 c0">&nbsp;the user first submits the rehydration request via
            Arroyo
            Client. Arroyo Client then forwards the request to the Arroyo Server. The request contains names of the
            files to
            be rehydrated as well as some additional data needed to process it. </span></p>
        <p class="c4"><span class="c10 c0">For each file that needs to be rehydrated, Arroyo Server sends a message to
            the
            Rehydration SQS Queue. Within the body of the message the Server includes information about </span></p>
        <ul class="c42 lst-kix_1o1htudhomlf-0 start">
          <li class="c23 c26"><span class="c37">S3 Bucket name</span><span class="c10 c0">&nbsp;where logs are
              stored</span>
          </li>
          <li class="c23 c26"><span class="c37">Key</span><span class="c10 c0">&nbsp;that represents the name of the
              file to
              be queried or fetched</span></li>
          <li class="c23 c26"><span class="c37">Logstash endpoint</span><span class="c10 c0">&nbsp;where the rehydrated
              logs
              will be forwarded to</span></li>
          <li class="c23 c26"><span class="c37">SQL expression</span><span class="c10 c0">&nbsp;which is optional and
              will
              only be included if the user chooses to perform a query instead of rehydrating the whole file</span></li>
        </ul>
        <p class="c4"><span class="c10 c0">Once the message is placed on the queue, Lambda function is invoked. Lambda
            will do
            one of two things: </span></p>
        <ul class="c42 lst-kix_glb7cfipagnw-0 start">
          <li class="c4 c26"><span class="c10 c0">If the message body contains a SQL expression, Lambda will use that
              SQL
              expression to query the file.</span></li>
        </ul>
        <ul class="c42 lst-kix_fjojr2om50e-0 start">
          <li class="c4 c26"><span class="c10 c0">Otherwise Lambda will fetch the whole file.</span></li>
        </ul>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 502.71px; height: 394.00px;"><img
              alt="" src="images/image12.gif"
              style="width: 502.71px; height: 394.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c4"><span class="c10 c0">Now we are gonna describe how the file containing logs is queried in a bit
            more
            detail. </span></p>
        <p class="c4"><span class="c25">We perform the query by utilizing the </span><span class="c37">Amazon S3 Select
          </span><span class="c25">feature. S3 Select allows for filtering and retrieving data contained within an S3
            buck</span><span class="c5">et. It allows us to query </span><span class="c10 c0">structured data using
            simple SQL
            statements. The log data stored in S3 bucket must be in JSON format. Although S3 select also supports CSV or
            Apache Parquet, currently Arroyo only supports JSON format.</span></p>
        <p class="c13"><span class="c25">To perform querying of the logs via the S3 Select feature</span><span
            class="c5">&nbsp;&ndash; we use </span><span class="c37 c17">selectObjectCo</span><span
            class="c37">ntent</span><span class="c10 c0">&nbsp;action to create and submit a query request. This is done
            via
            AWS SDK. We send the user generated SQL expression as a part of the request. We also specify that we would
            like
            any matches to be serialized and returned in JSON format. </span></p>
        <p class="c13"><span class="c10 c0">Once Amazon S3 receives the request, it parses the data into records and
            then
            returns the records that match the provided SQL expression.</span></p>
        <p class="c13"><span class="c25">Being able to query the log files allows us to retrieve a subset of the file
            contents
            and therefore reduce the amount of data that we re-ingest into the user&#39;s ELK stack.</span></p>
        <h2 class="c1 c29" id="h.pr98np9lenn4"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.u0awsqqsndxj"><span class="c3 c0">Reingest</span></h2>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1886.00px; height: 862.00px;"><img
              alt="" src="images/image25.png"
              style="width: 1886.00px; height: 862.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c13"><span class="c25">During the </span><span class="c25">Reingest</span><span
            class="c25">&nbsp;phase</span><span class="c10 c0 c17">&nbsp;Lambda makes a POST request to the Logstash
            endpoint
            provided by the user. Once the rehydrated logs are POSTed, Logstash forwards the logs to Elasticsearch.
            After they
            are indexed by Elasticsearch, the logs are ready to be viewed in the Kibana dashboard. </span></p>
        <h3 class="c31 c53 c63" id="h.alkgdz1xiyyr"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 530.04px; height: 394.00px;"><img
              alt="" src="images/image2.gif"
              style="width: 530.04px; height: 394.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></h3>
        <p class="c13"><span class="c5">But how does the Arroyo Client know when the reingestion job is completed so
            that it
            can notify the user? Let&rsquo;s take a look at how that happens.</span></p>
        <h2 class="c1 c29" id="h.r96o01xjc434"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.i1d7tqyq899f"><span class="c3 c0">Notify</span></h2>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 774.50px; height: 348.30px;"><img
              alt="" src="images/image8.png"
              style="width: 774.50px; height: 348.30px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c13"><span class="c10 c0">Once the logs are rehydrated and then forwarded to Logstash by Lambda,
            Arroyo
            application needs to be notified about the outcome of the rehydration request.</span></p>
        <p class="c13"><span class="c10 c0">After Lambda gets a response from Logstash, Lambda grabs the response data
            and
            packages it into a message. It then places that message onto a Status SQS queue. The goal of the Status
            queue is
            to hold the status of the reingestion tasks for the Arroyo server to pick up.</span></p>
        <p class="c13"><span class="c10 c0">While Lambda is processing tasks that are on the Rehydration Queue, the
            following
            happens on the Arroyo application server side. </span></p>
        <p class="c13"><span class="c10 c0">Once the Arroyo server finishes sending all of the messages to the
            Rehydration
            Queue, it starts polling Status Queue. </span></p>
        <p class="c31"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 800.00px; height: 625.00px;"><img
              alt="" src="images/image4.gif"
              style="width: 800.00px; height: 625.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c13"><span class="c10 c0">For each message it receives from the Status Queue, it saves the body of
            that
            message and then deletes that message from the queue. Once there are no more messages on the Status Queue,
            the
            Arroyo Server sends a single notification to the Arroyo Client via Server Sent Events.</span></p>
        <p class="c13"><span class="c10 c0">Arroyo Client receives the notification event and then notifies the user via
            a
            toast message. </span></p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-8"><span class="c15 c0">8. Engineering Decisions</span></h1>
        <p class="c13"><span class="c25">While developing Arroyo we encountered a number of engineering challenges:
            &nbsp;</span><span class="c25">how to make sure that we rehydrate logs in a controlled manner and without
            overwhelming Logstash service, how to ensure that Arroyo SQS Queues are not blocked by any problematic
            messages,
            and how to </span><span class="c5">collect the status of the reingestion job and notify the Client of its
            subsequent completion.</span><sup><a href="#cmnt10" id="cmnt_ref10">[j]</a></sup></p>
        <p class="c13 c21"><span class="c2 c0"></span></p>
        <h2 class="c1" id="h.ivaz3qcxrlde"><span class="c3 c0">Message Buffer</span></h2>
        <p class="c11"><span class="c10 c0">In order to re-ingest logs from S3 bucket we could simply configure Logstash
            S3
            input plugin to access the S3 bucket directly and reingest all of the logs that it contains.</span></p>
        <p class="c11"><span class="c25">The problem is that we do not need t</span><span class="c5">o
            re-ingest</span><span class="c10 c0">&nbsp;the entire bucket contents, instead, we need to be able to
            reingest the logs with
            precision.</span></p>
        <p class="c11"><span class="c10 c0">Potential alternative approach is to use an Http input plugin instead. With
            the
            Http input plugin we could send each rehydrated log or a whole log file as a POST request. However, there is
            a
            problem with this approach. </span></p>
        <p class="c11"><span class="c10 c0">As the number of rehydration tasks and number of POST requests to Logstash
            increases dramatically, we could potentially overwhelm the Logstash service. For example, if the user
            decides to
            reingest 1000s of files in a single rehydration job, with the current approach we would have to send 1000s
            of POST
            requests, one right after the other. </span></p>
        <p class="c11"><span class="c10 c0">This may result in Logstash service getting overwhelmed and even shutting
            down.</span></p>
        <h3 class="c9" id="h.l46274plmpsc"><span class="c14">Possible Solution: Kafka</span></h3>
        <p class="c13"><span class="c0 c10">The initial solution we came up with was to introduce Kafka into our
            architecture.</span></p>
        <p class="c13"><span class="c5">Kafka is a distributed event-streaming data store used for ingesting and
            processing of
            data in real-time. Kafka would serve as the middleman between the Arroyo application and the user&#39;s ELK
            stack.
          </span><span class="c25">In order to integrate Kafka we would have to create a Kafka Producer and we would
            also have
            to configure Logstash to be able to accept Kafka events. Kafka Producer could be a standalone Node
            application
            that would create and forward messages to a Kafka topic.</span><span class="c10 c0 c44">&nbsp;</span></p>
        <p class="c28"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 416.52px; height: 272.93px;"><img
              alt="" src="images/image26.gif"
              style="width: 416.52px; height: 272.93px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c13 c21"><span class="c10 c0 c17"></span></p>
        <p class="c13"><span class="c5">If we were to integrate Kafka into our architecture, we would be able to have
            full
            control over which logs are ingested and also ensure that the </span><span class="c10 c0">rehydration and
            reingestion layers are decoupled from the server logic.</span></p>
        <p class="c13"><span class="c10 c0">This approach would work well, but after conducting more research we came to
            a
            conclusion that setting up a Kafka Producer is a non-trivial task. </span></p>
        <h3 class="c9" id="h.f6q6apppfsfm"><span class="c14">Solution: AWS SQS and AWS Lambda</span></h3>
        <p class="c13"><span class="c10 c0">The solution that we decided to implement was a combination of Amazon SQS
            Queue
            and AWS Lambda Function. </span></p>
        <p class="c13"><span class="c10 c0">SQS Queue would serve as a buffer and Lambda would perform rehydration and
            reingestion tasks.</span></p>
        <p class="c31"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 452.50px; height: 341.07px;"><img
              alt="" src="images/image24.gif"
              style="width: 452.50px; height: 341.07px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <h4 class="c30" id="h.bifq0bmtrenu"><span>Amazon Simple Queue Service</span></h4>
        <p class="c13"><span class="c10 c0">Amazon Simple Queue Service is a fully managed solution that allows
            developers to
            easily create, use and manage a queue. Using a queue would allow us to create a buffer between the Arroyo
            Server
            and reingestion and rehydration layers. This would provide for better performance, scalability and
            reliability of
            the whole application.</span></p>
        <p class="c13"><span class="c10 c0 c17">Additionally, it is easily integrated with AWS Lambda and it is fairly
            simple
            to create and interact with using AWS SDK. </span></p>
        <p class="c13"><span class="c10 c0 c17">The downside of this choice is that introducing new components like an
            SQS
            queue increases the overall complexity of the application. </span></p>
        <h4 class="c62" id="h.vu8xdqg5l6ou"><span class="c47">AWS Lambda</span></h4>
        <p class="c13"><span class="c25">AWS Lambda is a serverless compute service that </span><span class="c25">allows
            to
            run code</span><sup><a href="#cmnt11" id="cmnt_ref11">[k]</a></sup><span class="c10 c0">&nbsp;without
            provisioning
            servers. It is easily integrated with SQS. </span></p>
        <p class="c13"><span class="c10 c0">In our case we programmatically created both SQS Queue and a AWS Lambda and
            then
            configured SQS Queue as Lambda&rsquo;s trigger, so that once the Queue receives a message, Lambda
            automatically
            spins up and performs rehydration and reingestion tasks.</span></p>
        <p class="c13"><span class="c10 c0">Benefit of using Lambda function is that it takes on rehydration and
            reingestion
            functions, therefore making our backend server more lightweight.</span></p>
        <p class="c13"><span class="c10 c0">The downside of using lambda was that deploying lambda programmatically
            still
            requires quite a bit of work.</span></p>
        <h2 class="c1 c29" id="h.flexk4aeipdr"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.ke0v9glsbcyf"><span class="c3 c0">Handling failed queue messages</span></h2>
        <p class="c13"><span class="c10 c0">Once we decided that using SQS Queue combined with AWS Lambda works best for
            our
            use case, the next issue we had to consider was how to ensure that the Queue is not blocked by any
            problematic
            messages.</span></p>
        <h3 class="c1" id="h.qp2txz6wzhmf"><span class="c14">Possible Solution: Error handling in Arroyo Server
            code.</span>
        </h3>
        <p class="c13"><span class="c25">The first approach w</span><span class="c5">e considered </span><span
            class="c10 c0">was to simply add more error handling and &ldquo;retry&rdquo; logic to the Server code. Upon
            further investigation as to what that logic should be, we realized that it might end up being very
            complex.</span>
        </p>
        <h3 class="c1" id="h.kl9ykt6dm1f0"><span class="c14">Solution: A Dead Letter Queue</span></h3>
        <p class="c13"><span class="c10 c0 c17">A Dead Letter Queue is a queue that is created specifically to hold
            messages
            that can&rsquo;t be processed. It allows us to put aside messages that failed, so that they don&rsquo;t
            block the
            queue. Also having a DLQ makes troubleshooting of failed messages much easier.</span></p>
        <p class="c31"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 389.17px; height: 272.93px;"><img
              alt="" src="images/image9.gif"
              style="width: 389.17px; height: 291.38px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c21 c38"><span class="c10 c0 c17"></span></p>
        <p class="c13"><span class="c5">Once the main queue, in our case Rehydration Queue, receives a message, it
            attempts to
            process the message </span><span class="c10 c17 c36">a specified number of times. If the message processing
            continues to fail and message retention is set to a relatively long period of time </span></p>
        <p class="c13"><span class="c10 c36 c17">or volume of messages is large, there is a chance of failed messages
            blocking
            the main queue.</span></p>
        <p class="c13"><span class="c5 c36">Having a Dead Letter Queue ensures that the main queue is not blocked and
            recovers
            quickly.</span></p>
        <h2 class="c1 c29" id="h.wdtruuau7uhv"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.zfiveqhi345p"><span class="c3 c0">Notifying the Client</span></h2>
        <p class="c11"><span class="c10 c0">While developing Arroyo we needed to ensure that the Client should have
            visibility
            into reingestion task status and is notified of a task&rsquo;s completion.</span></p>
        <p class="c11"><span class="c25">In order to achieve that we needed to somehow access the result of each POST
            request
            sent to Logstash, combine the results of all requests and pass it to the Arroyo application.</span></p>
        <h3 class="c1" id="h.th6zkuh10n61"><span class="c14">Possible Solution: Webhook</span></h3>
        <p class="c11"><span class="c10 c0">The first solution we considered involved setting up a Webhook. </span></p>
        <p class="c11"><span class="c10 c0">A webhook is an API endpoint that would accept data payload from a different
            service which in turn would trigger some event.</span></p>
        <p class="c11"><span class="c10 c0">Our backend would expose an endpoint - a Webhook, &nbsp;that would accept
            POST
            requests, each POST request would contain a status of a single reingestion job.</span></p>
        <p class="c11"><span class="c10 c0">We would also need the user to provide a host or an ip address of the
            machine
            where the Arroyo application is deployed and then we would need to pass that information to the Lambda, so
            that it
            knows where to POST the status.</span></p>
        <p class="c11"><span class="c5">This approach seemed like a viable solution. A downside of this approach is that
            the
            Notification layer would be tightly coupled with the rest of the logic.</span></p>
        <h3 class="c1" id="h.8e4vb3i8zn6t"><span class="c14">Solution: Status SQS Queue</span></h3>
        <p class="c11"><span class="c10 c0">Once the Lambda receives a response from Logstash, it would place a message
            containing the result of the request on the Status SQS Queue. The backend server would pick up and then
            process
            the message. Once all messages are processed, it would notify the Client.</span></p>
        <p class="c11"><span class="c25">One important positive of this approach is that if we were to build a more
            robust
            notification system in the future, we already have a way to access the status of each reingested log (or log
            file).</span></p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-9"><span class="c15 c0">9. Future Work</span></h1>
        <h2 class="c1" id="h.oah7nw748lr9"><span class="c3 c0">Improved Visibility</span></h2>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 238.82px; height: 238.82px;"><img
              alt="" src="images/image5.gif"
              style="width: 238.82px; height: 238.82px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c12"><span class="c0 c32">As Arroyo currently exists, a user is notified within the Arroyo client UI
            when a
            rehydration task is initiated or completed. This simple notification system may work well for smaller
            rehydration
            tasks with relatively short processing times. However, a user might feel left in the dark if processing
            times were
            to increase due to an increased log volume or network latency.</span></p>
        <p class="c12"><span class="c32 c0">One of the goals the Arroyo team has moving forward is to develop a more
            robust
            notification feature. For example, we want to notify users at various stages along the rehydration task and
            improve error messaging should a job fail.</span></p>
        <h2 class="c1 c29" id="h.u6u5pss7pthm"><span class="c0 c22"></span></h2>
        <h2 class="c1" id="h.1h4n5oogmxqd"><span class="c3 c0">Improved Searching</span></h2>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 191.00px; height: 230.09px;"><img
              alt="" src="images/image1.gif"
              style="width: 275.56px; height: 274.29px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c12"><span class="c32 c0">In the future, our team would like to expand Arroyo to be able to perform
            full-text searching to facilitate support for other log formats. We acknowledge that full-text searching is
            challenging at the best of times, but the ultimate goal would be to provide more flexibility for end
            users.</span>
        </p>
        <p class="c12"><span class="c59">Another search-related feature our team would like to improve is Arroyo&rsquo;s
            query
            rehydrate feature. Currently, Arroyo supports a maximum of two log attributes to search and rehydrate logs
            conditionally. We would like to enhance Arroyo&#39;s SQL expression-generating logic to support more complex
            queries.</span></p>
        <h2 class="c1 c29" id="h.8yhx1jiuzl0s"><span class="c22 c0"></span></h2>
        <h2 class="c1" id="h.v58grnrnllf1"><span class="c0 c3">More Flexibility</span></h2>
        <p class="c7"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 253.40px; height: 144.91px;"><img
              alt="" src="images/image11.png"
              style="width: 253.40px; height: 144.91px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
              title=""></span></p>
        <p class="c12"><span class="c32 c0">At the moment, Arroyo only integrates with AWS S3. Moving forward, our team
            would
            like to develop a strategy to support other cloud storage providers. Our team acknowledges that this is a
            non-trivial task and would require a significant redesign of our application. Our ultimate goal would be to
            extend
            the benefits of log rehydration to a broader range of use cases.</span></p>
        <hr>
        <p class="c8"><span class="c2 c0"></span></p>
        <h1 class="c1" id="section-10"><span class="c15 c0">10. References</span></h1>
        <h1 class="c1 c64" id="h.o90ubsjem4nm"><span class="c0 c15"></span></h1>
    </section>
  </div>

  <!-- TOC -->
  <aside id="toc" class="">
    <ul>
      <!-- Section 1 -->
      <li data-section="section-1" class="selected">
        <a href="#section-1">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Introduction</p>
          </div>
        </a>
      </li>
      <!-- Section 2 -->
      <li data-section="section-2">
        <a href="#section-2">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Observability</p>
          </div>
        </a>
      </li>
          <!-- Section 3 -->
      <li data-section="section-3" >
        <a href="#section-3">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Log Rehydration</p>
          </div>
        </a>
      </li>
      
      <!-- Section 4 -->
      <li data-section="section-4">
        <a href="#section-4">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Existing Solutions</p>
          </div>
        </a>
      </li>
      <!-- Section 5 -->
      <li data-section="section-5" >
        <a href="#section-5">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Arroyo</p>
          </div>
        </a>
      </li>
      <!-- Section 6 -->
      <li data-section="section-6" >
        <a href="#section-6">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Using Arroyo</p>
          </div>
        </a>
      </li>
      <!-- Section 7 -->
      <li data-section="section-7" >
        <a href="#section-7">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Arroyo Architecture</p>
          </div>
        </a>
      </li>
      
      <!-- Section 8 -->
      <li data-section="section-8" >
        <a href="#section-8">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Engineering Decisions</p>
          </div>
        </a>
      </li>
      
      <!-- Section 9 -->
      <li data-section="section-9" >
        <a href="#section-9">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>Future Work</p>
          </div>
        </a>
      </li>
      <!-- Section 10 -->
      <li data-section="section-10" >
        <a href="#section-10">
          <div>
            <div class="bullet">
              <div></div>
            </div>
            <p>References</p>
          </div>
        </a>
      </li>
    </ul>
  </aside>

  <!-- Footer -->
  <footer id="footer" class="wrapper style1">
    <div class="inner">
      <ul class="menu">
        <p style="color: lightgray;">&copy; 2022 Arroyo. All rights reserved.<br>Design: <a href="http://html5up.net">HTML5 UP</a></p>
      </ul>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/jquery.scrollex.min.js"></script>
  <script src="assets/js/jquery.scrolly.min.js"></script>
  <script src="assets/js/browser.min.js"></script>
  <script src="assets/js/breakpoints.min.js"></script>
  <script src="assets/js/util.js"></script>
  <script src="assets/js/main.js"></script>
  <script src="assets/js/script.js"></script>
</body>

</html>
